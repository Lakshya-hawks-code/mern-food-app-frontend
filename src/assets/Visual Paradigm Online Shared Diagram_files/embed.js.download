function init() {
	var els = document.getElementsByClassName('vponline-viewer');
	if (els && els.length > 0) {
		var el = els[0];
		var page = el.dataset.page;
		var w = el.dataset.w;
		var h = el.dataset.h;
		var responsive = el.dataset.responsive || '1';
		var toolbar = el.dataset.toolbar || '0';
		var ws = el.dataset.ws;
		var baseUrl = el.dataset.baseUrl;
		var id = el.dataset.id;

		var getBaseUrl;
		if (baseUrl) {
			getBaseUrl = Promise.resolve(baseUrl);
		} else {
			getBaseUrl = fetch('https://online.visual-paradigm.com/rest/domain?workspace=' + ws)
			.then(function (r) {
				return r.text();
			})
			.then(function (domain) {
				return 'https://' + domain + '/';
			});
		}
		getBaseUrl.then(function (baseUrl) {
			return fetch(baseUrl + 'rest/diagrams/shares/diagram/' + id + '/content', {
				credentials: 'include'
			})
			.then(function (r) {
				return r.text();
			});
		})
		.then(function (content) {
			var iframeEl = document.createElement('iframe');
			iframeEl.style.border = 0;
			iframeEl.style.width = w.slice(-1) === '%' ? w : w + 'px';
			iframeEl.style.height = h.slice(-1) === '%' ? h : h + 'px';
			window.addEventListener('message', function (event) {
				if (event.data.type === 'resize') {
					//iframeEl.style.width = Math.ceil(event.data.width) + "px";
					iframeEl.style.height = Math.ceil(event.data.height) + "px";
				}
			});
			var params = {
				lightbox: 1,
				highlight: '0000ff',
				toolbar: toolbar,
				'page-id': page
			};
			if (responsive === '1') {
				params.vpviewer = 2;
			} else {
				params.vpviewer = 1;
			}
			var paramStr = Object.keys(params).filter(function (k) {
				return params[k];
			}).map(function (k) {
				return k + '=' + encodeURIComponent(params[k]);
			}).join('&');
			iframeEl.src = 'https://online.visual-paradigm.com/app/diagrams/?' + paramStr + '#R' + encodeURIComponent(content);
			el.parentElement.replaceChild(iframeEl, el);
		});
	}
}
document.addEventListener("DOMContentLoaded", init);
window.vpViewer = {
	init: init
}